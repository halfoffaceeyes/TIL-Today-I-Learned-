# MQTT(Message Queuing Telemetry Transport)
* 머신 대 머신 통신에 사용되는 표준 기반 메시징 프로토콜
* 스마트 센서, 웨어러블 및 IoT 디바이스는 일반적으로 리소스 제약이 있는 네트워크를 통해 제한된 대역폭으로 데이터를 전송하고 수신해야함
* IoT 디바이스는 구현이 쉽고 데이터를 효율적으로 전달하기 위해 MQTT를 사용
* MQTT는 디바이스에서 클라우드, 클라우드에서 디바이스로의 메시징을 지원

# MQTT의 특징
1. 가볍고 효율적임
    * MQTT는 IoT디바이스에 구현할 때 최소한의 리소스가 필요하기 때문에 작은 마이크로컨트롤러에도 사용가능
    * 가장 작은 MQTT 제어 메시지는 2바이트 정도의 크기
    * MQTT 메시지 헤더도 작기 때문에 네트워크 대역폭을 최적화 가능

2. 확장성
    * MQTT 구현에는 최소량의 코드가 필요하고 작업시 아주 작은 전력만 소비하므로 수백만 개의 디바이스에 연결할 수 있음

3. 신뢰성
    * IoT 디바이스는 대역폭이 낮고 지연시간은 긴 신뢰할 수 없는 셀룰러 네트워크를 통해 연결됨
    * MQTT는 IoT 디바이스와 클라우드를 다시 연결하는데 걸리는 시간을 줄여주는 기능이 있음
    * 최대 1회, 최소 1회, 정확히 1회라는 3가지 서비스 품질 수준을 정의해 신뢰성을 보장

4. 보안
    * MQTT를 사용하면 메시지를 손쉽게 암호화 가능
    * OAuth, TLS1.3, 고객 관리형 인증서 및 기타 최신 인증 프로토콜을 사용하여 디바이스와 사용자를 인증할 수 있음
    * MQTT 통신은 SSL 프로토콜을 사용하여 IoT 디바이스에서 전송되는 민감한 데이터를 보호
    * SSL 인증서와 암호를 사용하여 클라이언트, 브로커 간에 ID, 인증 및 권한 부여를 구현할 수 있음
    * 브로커는 일반적으로 암호와 각 클라이언트에 할당되는 고유 클라이언트 식별자를 사용하여 클라이언트를 인증
    * MQTT와 함께 암호화 프로토콜을 구현 가능

# MQTT의 원리
* 전통적인 네트워크 통신에서는 클라이언트와 서버가 서로 직접 통신
* MQTT는 게시/구독 패턴을 사용하여 메시지 발신자와 수신자를 분리하고 그 사이에 브로커를 설정
* 브로커는 발신자로부터 수신되는 모든 메시지를 필터링하고 구독자에게 직접 배포
* 애플리케이션 계층에서 게시/구독 모델 통신을 사용하며 메시지를 푸시 방식으로 전송
* 고정된 TCP 연결이 필요

## 브로커의 역할
* 공간 분리
    * 게시자와 구독자는 서로의 네트워크 위치를 모르고 IP 주소 또는 포트 번호와 같은 정보를 교환하지 않음
* 시간 분리
    * 게시자와 구독자는 동시에 실행되거나 네트워크를 통해 연결되지 않음
* 동기화 분리
    * 게시자와 구독자는 서로를 중단시키지 않고 메시지를 전송하거나 수신할 수 있음
    * 구독자는 게시자의 메시지를 전송할때까지 기다리지 않아도 됨

# MQTT 구성요소
## MQTT 클라이언트
* 서버부터 MQTT 라이브러리를 실행하는 마이크로 컨트롤러에 이르는 모든 디바이스
* 메시지를 보내면 게시자, 메시지를 수신하면 수신자의 역할
* 네트워크를 통해 MQTT를 사용하는 모든 디바이스를 칭함

## MQTT 브로커
* 여러 클라이언트 간의 메시지를 조정하는 백엔드 시스템
* 브로커는 메시지 수신 및 필터링, 각 메시지를 구독하는 클라이언트 식별, 메시지 전송 등과 같은 작업을 담당
    * MQTT 클라이언트 권한 부여 및 인증
    * 추가 분석을 위해 다른 시스템으로 메시지 전달
    * 누락된 메시지 및 클라이언트 세션 처리

## MQTT 연결
* 클라이언트와 브로커는 MQTT 연결을 사용하여 통신 시작
* 클라이언트가 연결 메시지를 MQTT 브로커로 보내면서 연결 시작 -> 브로커가 연결 메시지를 응답해 연결이 설정됨을 확인

# MQTT 작동 방식
* MQTT 클라이언트가 MQTT 브로커와의 연결을 설정
* 연결된 클라이언트에서 메시지를 게시하거나 특정 메시지를 구독
* MQTT 브로커는 메시지 수신 후 메시지에 관심있는 구독자에게 메시지 전달

## MQTT 주제
* MQTT 브로커가 MQTT 클라이언트를 위한 메시지를 필터링할 때 사용하는 키워드
* 주제는 파일 또는 폴더 디렉토리와 유사한 계층 구조로 정렬

## MQTT 게시
* 클라이언트는 주제 및 데이터를 바이트 형식으로 포함된 메시지를 게시(텍스트, 바이너리, XML, JSON 파일 형식)

## MQTT 구독
* MQTT 클라이언트가 MQTT 브로커에 구독메시지를 보내 관심 주제에 대한 메시지를 수신
* 메시지에 구독의 고유식별자와 목록이 포함


# MQTT Library
* paho-mqtt